---
title: "基本の構文"
---

# 概要
> *p.19 **7.1 General***

PDFの構文は次の４つから構成されています。

## オブジェクト（ Objects ）

PDFドキュメントは**データオブジェクト**の集合です。

データオブジェクトは普通のプログラムでいうデータ型とその値のようなものです。

## ファイル構造（ File structure ）

オブジェクトのようなデータ構造とは別に、データがどのようにPDFファイルに保存されるか、どのように更新されるか、どのように暗号化されるか、などの情報を表します。

## ドキュメント構造（ Document Structure）

ドキュメント構造はPDF内のデータ（オブジェクトなど）がどのように表示されるのかを表します。

差し詰めオブジェクトの集合が HTML だとするなら、ドキュメント構造は CSS のようなものでしょうか。

## コンテンツストリーム（ Content stream ）

オブジェクトの一種ですが、ドキュメント構造の一部としてのオブジェクトとは区別されます。

ストリームというと、プログラミングに馴染みのある人ならバイトストリームなどを思い浮かべるかもしれませんが、コンテンツストリームはバラバラのデータ型のオブジェクトの集合です。

ページの表示だけでなく、グラフィックの表示方法にも関連します。

PDF本体はバイト配列ですが、それと混同しないようにしてください。

# PDFのキャラクターセット

> *p.12 **.2 7.2 Character Set***

PDF中の文字は３つの区分に分けられます。

- **通常の文字**（ `a`や`3`、`あ`など）
- **空白文字**
- **デリミタ**（区分文字）

通常の文字に関してはだいたい想像がつくかと思うので、ここでは空白文字とデリミタだけを取り上げます。

## 空白文字

空白文字とは総じて、画面には表示されないがプログラム的に意味を持つ文字のことです。

|名称|文字コード（10進数）|
|:-|:-:|
|ヌル文字|`0`|
|水平タブ（HT）|`9`|
|ラインフィード（LF）|`10`|
|フォームフィード（FF）|`12`|
|キャリッジリターン（CR）|`13`|
|スペース（SPACE）|`32`|

キャリッジリターン（CR）とラインフィード（LF）はどちらも**改行文字**と呼ばれ、CR のすぐ次に LF が続くと行末（ ***end-of-line : EOL*** ）とみなされます。

## デリミタ : *Delimiter*

デリミタはオブジェクトの名前（強いていうなら変数名）、文字列リテラル、配列リテラルなどに使用され、PDFの理解にとって重要です。

|文字|文字コード（10進数）|
|:-:|:-:|
|`(`|`40`|
|`)`|`41`|
|`<`|`60`|
|`>`|`62`|
|`[`|`91`|
|`]`|`93`|
|`{`|`123`|
|`}`|`125`|
|`/`|`47`|
|`%`|`37`|

この中のほとんどの文字はのちの解説でも取り扱うので今は解説しませんが、`%` はここで説明しておきます。

`%` から行末まではコメントとみなされます。CRLF（EOL）以外のコメント内の文字は処理的に意味を持ちません（`%` の後に `%` を加えてもコメントの終わりにはなりません）。

以下の文は意味的に `abc(改行)123` と同じ意味になります。

```pdf:%から行末までは無視され、次の行から認識される
abc% comment ()[]/%+-& 345
123
```

# 基本のデータ型（Objects）

> *p.13 **7.3 Objects*** 

## 概要

PDFのデータ型には以下のものがあります。

- 真偽値（Boolean Objects）
- 数値（Numeric Objects）
    - 符号付き整数（Integer）
    - 符号付き小数点数（Real Number）
- 文字列（String Objects）
    - リテラル文字列（Literal String）
    - 16進数文字列（Hexadecimal String）
- 名前オブジェクト（Name Objects）
- 配列（Array Objects）
- 辞書（Dictionary Objects）
- Null（Null Objects）

オブジェクト指向言語に慣れきっている現代プログラマにとっては紛らわしいかもしれないのですが、PDFでは基本の値をすべて**オブジェクト**と形容します。

## 真偽値（Boolean Objects）

`true` あるいは `false` のいずれかです。

## 数値（Numeric Objects）

数値を表すオブジェクトは以下の２種類があります。

### 符号付き整数（Integer）

整数を表すオブジェクトです。

数値の精度はPDFを解釈するプログラムに依存します。

```pdf:Integer の例
12
+345
-89
0
```

:::details 数値の精度とは
プログラム上での数値の扱い方はそのプログラミング言語の使用やCPUアーキテクチャなどに依存します。

例えば **C++** などのシステムプログラミング言語では、整数と浮動小数点数、符号付き整数や符号なし整数など、厳密な区分がありますが、対して **JavaScript** などのインタプリタ言語の中には、数値を一緒くたに浮動小数点数として扱うものもあります。

そして一つの数値型で扱える数値の桁数や大きさも、同じIntegerという名前がつけられていても、プログラミング言語が変われば扱える数字の大きさも変わってきます。

例えば、[C++の `signed integer` の範囲](https://learn.microsoft.com/ja-jp/cpp/cpp/data-type-ranges?view=msvc-170)は `-2,147,483,648 ～ 2,147,483,647`、64bitアーキテクチャ上の [**PHP**](https://www.php.net/manual/en/reserved.constants.php#constant) であれば`-9,223,372,036,854,775,808 〜 9,223,372,036,854,775,807`です。
:::

### 符号付き小数点数（Real Number）

Real Number は上記の Integer に小数点がついたものです。

小数点の隣が `0` の場合は `0` の表記を省くことができます。

```pdf:Real Number の例
1.4
0.9
.76
53.
-.07
+8.
```

:::message
**「小数点数」という表現について**

ここでは便宜上、Real Number のことを小数点数と呼んでいますが、仕様書上では「小数点数」という言葉（float、double）は使われていません。

単精度でも倍精度でもないということを表現したかったのかもしれませんが、「実数」という言葉を使うとプログラム的に曖昧すぎると思ったため、ここではあえて小数点数と表現しています。

ここでの小数点数は、固定少数点数と浮動小数点数を区別しない小数点ありの数値、というふうに捉えてください。
:::

## 文字列（String Objects）

文字列にも２つの種類があります。

- リテラル文字列（Literal String）
- 16進数文字列（Hexadecimal String）

### リテラル文字列（Literal String）

プログラミング経験者なら馴染みのある文字列リテラルですが、PDFの場合はダブルクオテーション（`"`）でもシングルクオテーション（`'`）でもなく、括弧（`()`）で文字列を囲みます。

```pdf:リテラル文字列の例
(文字列です)
(()は無視されます)
(&%^/<#$などの記号も入れられます)
() %これは空文字です
```
バックスラッシュ（`\`）はエスケープ文字として認識されます。

以下のいずれかの組み合わせでない場合、バックスラッシュは無視されます。

|エスケープシーケンス|意味するもの|
|:-:|:-:|
|`\n`|ラインフィード（LF）|
|`\r`|キャリッジリターン（CR）|
|`\t`|水平タブ（HT）|
|`\b`|バックスペース（BS）|
|`\f`|フォームフィード（FF）|
|`\(`|左括弧|
|`\)`|右括弧|
|`\\`|バックスラッシュ|
|`\245`|８進数で`245`という文字コード|

また、文字列中の行末のバックスラッシュは、文字列が次の行にも続いていることを表します。

バックスラッシュをつけずに改行している場合は単に改行（LF）とみなされます。

```pdf:２つの文字列は同じ意味です
(私はPDFについて勉強しています)

(私はPDFにつ\
いて勉強しています)
```

８進数文字コードのエスケープシーケンスは１〜３桁の文字コードとみなされ、桁数が足りない場合は `0` で埋められます。

逆に４桁以上の場合は３桁までで切り捨てられます。

```pdf:８進数文字コードの例
(\9) % => 水平タブ
(\009) % => 水平タブ
(\097) % => a
(\0097) % => 水平タブ（４桁目が切り捨てられた）
```

:::message 
**PDFの文字コード**

PDF中の文字は基本的にASCII（ANSI X3.4-1986）です。ASCII以外の文字は文字列の中でのみ使用されます。

コメント内の非ASCII文字が扱えるかは環境によりますが、本書では便宜上のため日本語のコメントを使用します。
:::

### 16進数文字列（Hexadecimal String）

`<>` を用いて記述します。

ASCII文字が基本のリテラル文字列に比べ、非ASCII文字を扱うのに適しています。

```pdf:16進数文字列の例
<E38193E38293E381ABE381A1E381AF> % => こんにちは
```

偶数で一つの文字とみなされ、奇数の場合はエスケープシーケンスの８進数と同じく `0` 埋めされます。

```pdf:奇数の場合は0が入ると認識される
<E3819> % => ぐ
<E38190> % => ぐ
```

スペース（`20`）、水平タブ（`09`）、キャリッジリターン（`0D`）などの空白文字は無視されます。


## 名前オブジェクト（Name Objects）

名前オブジェクトはPDFファイルの中で一意のシンボルです。

別々の場所に同じ名前オブジェクトが現れても、それらは同じ値を指します。

名前オブジェクトとして使用される文字は、例外を除いて文字そのものとしては評価されません。

名前オブジェクトはスラッシュ（`/`）を使って表現します。スラッシュそのものは名前オブジェクトであることを示唆するものであって、名前オブジェクトには含まれません。

```pdf:名前オブジェクトの例
/Name % => Name
/189 % => 189
/@;$ % => @;$
```

名前オブジェクト中の文字には16進数の文字コードが使用できます。16進数文字コードを使うには `#` を用います。

また、記号も名前オブジェクトとして使えますが、エクスクラメーションマーク（`!`）からチルダ（`~`）の間の記号（ 21 〜 7E ）は16進数文字コードとして記述する必要があります。

```pdf:16進数を使った名前オブジェクト
/16#2890#2954 % => 16(90)54
/Nippon#20Tarou % => Nippon Tarou
```

## 配列（Array Objects）

PDFでの配列は静的型付け言語と違い、さまざまなデータ型を格納できます。

配列の定義には馴染みのある `[]` を用います。各要素は空白で区切ります。

```pdf:配列の例
[17 6.0 true /Name (A string.)]
```

## 辞書（Dictionary Objects）

